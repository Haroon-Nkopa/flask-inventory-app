<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Inventory Summary</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-dark text-light">
  <div class="container mt-5 text-center">
    <h2 class="mb-4">Inventory Summary</h2>

    <!-- ‚úÖ Flash messages -->
  <div class="container mt-3">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
  </div>

    {% if message %}
    <div class="alert alert-success">
      {{ message }}
    </div>
    {% endif %}

    <div class="mt-5">
      <h4 class="text-info mb-3">üìà Sales Trend</h4>

      <div class="bg-dark p-3 rounded">
        <canvas id="salesChart"></canvas>
      </div>
    </div>


    <div class="container mt-5">
      {% if stock_out_products %}
  <div class="alert alert-warning mt-4">
    <h5 class="mb-3">‚ö†Ô∏è Stock Out Products ({{ stock_out_products|length }})</h5>

    <table class="table table-dark table-striped table-bordered">
      <thead>
        <tr>
          <th>Product</th>
          <th>Category</th>
          <th>Price (R)</th>
        </tr>
      </thead>
      <tbody>
        {% for p in stock_out_products %}
          <tr>
            <td>{{ p.name }}</td>
            <td>{{ p.category or '-' }}</td>
            <td>{{ "%.2f"|format(p.price or 0) }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="alert alert-success mt-4">
    ‚úÖ No stock-out products. Inventory is healthy.
  </div>
{% endif %}

{% if fast_selling %}
<div class="mt-5">
  <h4 class="text-warning mb-3">üî• Fast Selling Products</h4>

  <table class="table table-dark table-striped table-bordered">
    <thead>
      <tr>
        <th>Product</th>
        <th>Category</th>
        <th>Units Sold</th>
      </tr>
    </thead>
    <tbody>
      {% for p in fast_selling %}
      <tr>
        <td>{{ p.name }}</td>
        <td>{{ p.category or '-' }}</td>
        <td><strong>{{ p.sold_qty }}</strong></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}


{% if top_earning %}
<div class="mt-5">
  <h4 class="text-success mb-3">üí∞ Top Money-Making Products</h4>

  <table class="table table-dark table-striped table-bordered">
    <thead>
      <tr>
        <th>Product</th>
        <th>Category</th>
        <th>Revenue (R)</th>
      </tr>
    </thead>
    <tbody>
      {% for p in top_earning %}
      <tr>
        <td>{{ p.name }}</td>
        <td>{{ p.category or '-' }}</td>
        <td><strong>R {{ "%.2f"|format(p.revenue) }}</strong></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}


    </div>


    <div class="mt-3">
      <a href="{{ url_for('main.shop') }}" class="btn btn-outline-light">‚Üê Back to Inventory</a>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const chartLabels = {{ chart_labels | tojson | safe }};
  const chartValues = {{ chart_values | tojson | safe }};

  const ctx = document.getElementById('salesChart').getContext('2d');

  const salesChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: chartLabels,
      datasets: [{
        label: 'Daily Sales (R)',
        data: chartValues,
        borderColor: '#0dcaf0',
        backgroundColor: 'rgba(13, 202, 240, 0.2)',
        tension: 0.4,
        fill: true,
        pointRadius: 5,
        pointHoverRadius: 7
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          labels: { color: '#fff' }
        }
      },
      scales: {
        x: {
          ticks: { color: '#ccc' },
          grid: { color: '#333' }
        },
        y: {
          ticks: { color: '#ccc' },
          grid: { color: '#333' }
        }
      }
    }
  });
</script>


</body>
</html>
